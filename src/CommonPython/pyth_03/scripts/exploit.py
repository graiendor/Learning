from bs4 import BeautifulSoup
from urllib.request import urlopen

soup = BeautifulSoup(urlopen("http://127.0.0.1:8000/evilcorp.html"))

soup.title.string = "Evil Corp - Stealing your money every day"
print(soup)

name = soup.find("span", {"class": "name"}).text

newTag = soup.new_tag("h1", name)
newTag.string = "You are hacked, " + name

soup.html.body.append(newTag)

scriptTag = soup.new_tag('script')

script = "hacked = function() {" \
            "alert('hacked');" \
         "}" \
         "window.addEventListener('load', " \
         "function() { " \
            "var f = document.querySelector('form');" \
            "f.setAttribute('onsubmit', 'hacked()');" \
         "}," \
            "false" \
         ");" \

scriptTag.append(script)

soup.html.body.append(scriptTag)

link = soup.find('a', {'href': 'https://mrrobot.fandom.com/wiki/E_Corp'})

link['href'] = link['href'].replace("https://mrrobot.fandom.com/wiki/E_Corp", "https://mrrobot.fandom.com/wiki/Fsociety")

with open("../evilcorp_hacked.html", "w", encoding='utf-8') as output:
    output.write(str(soup))